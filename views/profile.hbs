<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width-device-width, initial-scale=1.0">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
	<link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/profile.css">
    <link rel="stylesheet" href="/classlist.css">
    <link rel="shortcut icon" href="#" />
	<title>UACShub</title>
</head>
<body>
	<nav>
		<h4>Node MySQL</h4>
		<ul>
			<li><a href="/">Home</a></li>
            <li><a href="/chatroom">Chatroom</a></li>
		</ul>
	</nav>

    <div class="container">
    <div class="header">
        <div class="full-name" id="full-name">
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
            <script>
                $.ajax({
                    type: "GET",
                    url: "http://localhost:8080/getName",
                    dataType: "json"
                }).done(function (data){
                    $('#full-name').text(data[0].name)
                }).fail(function(jqXHR, textStatus, errorThrown){
                    alert("AJAX call failed: " + textStatus + ", " + errorThrown);
                });
            </script>
        </div>
        <div class="contact-info">
            <span class="email">Email: </span>
            <span class="email-val" id="email">
                <script>
                    $.ajax({
                        type: "GET",
                        url: "http://localhost:8080/getEmail",
                        dataType: "json"
                    }).done(function (data){
                        $('#email').text(data[0].email)
                    }).fail(function(jqXHR, textStatus, errorThrown){
                        alert("AJAX call failed: " + textStatus + ", " + errorThrown);
                    });     
                </script>
            </span>
        </div>
        
        <div class="about">
            <span class="position">Student </span>
            <span class="desc">
            </span>
        </div>
    </div>
    <div class="details">
        <div class="section">
            <div class="section__title">
            Classes
            </div>
            <div class="section__list">
                <div class="section__list-item" id="list-item">
                    <script>
                        $.ajax({
                            type: "GET",
                            url: "http://localhost:8080/getAttributes",
                            dataType: "json"
                        }).done(function (data){
                            for(i=0; i < data.length; i++){
                                if (data[i].class != null)
                                    $('#list-item').append(`<li><input type="checkbox" name="class-check" id=${data[i].class}/>  ${data[i].class} </li>`)
                            }
                        }).fail(function(jqXHR, textStatus, errorThrown){
                            alert("AJAX call failed: " + textStatus + ", " + errorThrown);
                        });                       
                    </script>
                    
                </div>
                <button type="button" id="delete-class">Delete</button>
                <script>
                    $(document).on('click', '#delete-class', function() {
                            var checkboxes = document.getElementsByName('class-check');
                            var checked = [];
                            for (var i = 0; i < checkboxes.length; i++){
                                if (checkboxes[i].checked) {
                                    cname = checkboxes[i].id.slice(0,-1)
                                    checked.push(cname)
                                }
                            }
                            var xhr = new XMLHttpRequest();
                            xhr.open("POST", "http://localhost:8080/deleteClass", true)
                            xhr.setRequestHeader('Content-Type', 'application/json')
                            
                            xhr.send(JSON.stringify({
                                value: checked
                            }))
                        
                    });               
                </script>
            </div>
        </div>
        <div class="section">
            <div class="section__title">Technologies</div>
            <div class="skills">
                <div class="skills__item" id="skills-item">
                <div class="left"><div class="name">
                    <script>
                        $.ajax({
                            type: "GET",
                            url: "http://localhost:8080/getAttributes",
                            dataType: "json"
                        }).done(function (data){
                            for(i=0; i < data.length; i++){
                                if (data[i].technology != null)
                                    $('#skills-item').append(`<li><input type="checkbox" id=${data[i].technology} name="technology-check"/> ${data[i].technology} </li>`)
                            }
                        }).fail(function(jqXHR, textStatus, errorThrown){
                            alert("AJAX call failed: " + textStatus + ", " + errorThrown);
                        });

                    </script>
                    </div></div>
                </div>
            <button type="button" id="delete-tech">Delete</button>
            <script>
                $(document).on('click', '#delete-tech', function() {
                        var checkboxes = document.getElementsByName('technology-check');
                        var checked = [];
                        for (var i = 0; i < checkboxes.length; i++){
                            if (checkboxes[i].checked) {
                                checked.push(checkboxes[i].id)
                            }
                        }
                        var xhr = new XMLHttpRequest();
                        xhr.open("POST", "http://localhost:8080/deleteTechnology", true)
                        xhr.setRequestHeader('Content-Type', 'application/json')
                        
                        xhr.send(JSON.stringify({
                            value: checked
                        }))
                    
                });               
            </script>
            <button type="button" id="addTechBtn">Add</button>
            <input type="text" id="addTech" class="addTech">
            <script>
                $(document).on('click', '#addTechBtn', function() {
                    var tech = document.getElementById('addTech').value

                    var xhr = new XMLHttpRequest();
                    xhr.open("POST", "http://localhost:8080/addTech", true)
                    xhr.setRequestHeader('Content-Type', 'application/json')
                    


                    test = JSON.stringify({
                        value: tech
                    })

                    xhr.send(test)
                });
            </script>
            </div>           
        </div>
        <div class="section">
            <div class="section__title">
            Interests
            </div>
        <div class="section__list">
            <div class="section__list-item">
                    Programming, Video Games, Hiking, Skateboarding
            </div>
        </div>
        </div>
        </div>
    </div>
    </div>


    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>

  <h2 id="classlist">Classlist</h2>
    <table id="classtable">
      <thead>
        <tr>
          <th>Add Class</th>
          <th>Class id</th>
          <th>Class name</th>
        </tr>
      <thead>
      <tbody id="tbody">
        <script>
            $(document).ready(() => {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function(){
                    if(xhr.readyState == XMLHttpRequest.DONE) {
                        var body = JSON.parse(xhr.response)
                            console.log(body)
                            console.log(body[0].classid)

                        for(var i = 0; i < body.length; i++){
                            var row = document.createElement("tr")
                            var element = document.getElementById("tbody")
                            
                            var addcol = document.createElement("td")
                            var addcolb = document.createElement("button")
                            addcolb.id = 'addClassButton'
                            addcolb.class = body[i].classid
                            var addcolbtext = document.createTextNode("Add Class")

                            addcolb.appendChild(addcolbtext)
                            addcol.appendChild(addcolb)
                            row.appendChild(addcol)

                            var classid = body[i].classid
                            var idcol = document.createElement("td")
                            var idtext = document.createTextNode(classid.toString())
                            idcol.appendChild(idtext)
                            row.appendChild(idcol)

                            var classname = body[i].classname
                            var namecol = document.createElement("td")
                            var nametest = document.createTextNode(classname)
                            namecol.appendChild(nametest)
                            row.appendChild(namecol)

                            element.appendChild(row)                  
                        }

                    }
                }
                xhr.open("GET", "http://localhost:8080/getClass")
                xhr.setRequestHeader('Content-Type', 'application/json')
                
                xhr.send()
            }
            )
        </script> 
        <script>
            $(document).on('click', '#addClassButton', function() {
                    var classid = this.class
                    

                    var xhr = new XMLHttpRequest();
                    xhr.open("POST", "http://localhost:8080/addClass", true)
                    xhr.setRequestHeader('Content-Type', 'application/json')
                    
                    xhr.send(JSON.stringify({
                        value: classid
                    }))
                
            });               
        </script>
      </tbody>
    <table/>
      

</div>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
</body>
</html>